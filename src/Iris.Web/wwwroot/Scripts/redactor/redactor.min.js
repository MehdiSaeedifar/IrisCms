var _0xf6db=["(6(){11 49=24;11 14={50:6(8,10){5 10.58(8)&92},57:6(8,10){7(8.58!=12){5 8.58(10)&16}46{5 8.57(10)}},55:6(8,18,10,20){7(8===10){5 18<=20}7(14.29(8)&&14.29(10)){5 14.50(8,10)}7(14.29(8)&&!14.29(10)){5!14.55(10,20,8,18)}7(!14.57(8,10)){5 14.50(8,10)}7(8.47.85<=18){5 40}7(8.47[18]===10){5 0<=20}5 14.50(8.47[18],10)},29:6(61){5(61!=12?61.93==3:40)},81:6(41){11 62=0;88(41=41.59){62++}5 62}};11 4=49.4=(6(){6 4(2){24.2=2}4.34.31=6(){5 4.31(24.2)};4.34.37=6(){5 4.37(24.2)};4.34.38=6(){5 4.38(24.2)};4.34.45=6(){5 4.45(24.2)};4.34.44=6(){5 4.44(24.2)};4.34.52=6(25,26,23,22){5 4.52(24.2,25,26,23,22)};4.34.51=6(){5 4.51(24.2)};5 4})();7(49.35){4.67=43;4.31=6(2){11 9;5(9=2.35())&&(9.63!=12)&&(9.36!=12)};4.37=6(2){11 9;7(!((9=2.35())&&(9.36!=12))){5 12}5[9.36,9.97]};4.38=6(2){11 9;7(!((9=2.35())&&(9.63!=12))){5 12}5[9.63,9.91]};4.45=6(2){11 8,10,18,20,27,28;7(!4.31(2)){5 12}27=4.37(2),8=27[0],18=27[1];28=4.38(2),10=28[0],20=28[1];7(14.55(8,18,10,20)){5[8,18]}5[10,20]};4.44=6(2){11 8,10,18,20,27,28;7(!4.31(2)){5 12}27=4.37(2),8=27[0],18=27[1];28=4.38(2),10=28[0],20=28[1];7(14.55(8,18,10,20)){5[10,20]}5[8,18]};4.52=6(2,25,26,23,22){11 9=2.35();7(!9){5}7(23==12){23=25}7(22==12){22=26}7(9.60&&9.79){9.60(25,26);9.79(23,22)}46{54=2.15.56();54.106(25,26);54.107(23,22);71{9.73()}80(41){}9.98(54)}};4.51=6(2){71{11 9=2.35();7(!9){5}9.73()}80(41){}}}46 7(49.15.39){11 69=6(42,32,30){11 19,13,21,33,64;13=42.90('89');19=32.103();19.60(30);64=19.77();88(43){64.86(13,13.59);19.82(13);7(!(19.87((30?'66':'83'),32)>0&&(13.59!=12))){99}}7(19.87((30?'66':'83'),32)===-1&&13.84){19.74((30?'100':'78'),32);21=13.84;33=19.101.85}46{21=13.48;33=14.81(13)}13.48.72(13);5[21,33]};11 68=6(42,32,30,21,33){11 36,65,19,13,53;53=0;36=14.29(21)?21:21.47[33];65=14.29(21)?21.48:21;7(14.29(21)){53=33}13=42.90('89');65.86(13,36||12);19=42.76.75();19.82(13);13.48.72(13);32.74((30?'66':'78'),19);5 32[30?'105':'104']('102',53)};4.67=43;4.31=6(2){11 17;2.70();7(!2.15.39){5 40}17=2.15.39.56();5 17&&17.77().15===2.15};4.45=6(2){11 17;2.70();7(!4.31(2)){5 12}17=2.15.39.56();5 69(2.15,17,43)};4.44=6(2){11 17;2.70();7(!4.31(2)){5 12}17=2.15.39.56();5 69(2.15,17,40)};4.37=6(2){5 4.45(2)};4.38=6(2){5 4.44(2)};4.52=6(2,25,26,23,22){7(23==12){23=25}7(22==12){22=26}11 17=2.15.76.75();68(2.15,17,40,23,22);68(2.15,17,43,25,26);5 17.96()};4.51=6(2){5 2.15.39.95()}}46{4.67=40}}).94(24);","|","split","||win||Selection|return|function|if|n1|sel|n2|var|null|cursorNode|Dom|document||range|o1|cursor|o2|node|foco|focn|this|orgn|orgo|_ref|_ref2|isText|bStart|hasSelection|textRange|offset|prototype|getSelection|anchorNode|getOrigin|getFocus|selection|false|e|doc|true|getEnd|getStart|else|childNodes|parentNode|root|isPreceding|clearSelection|setSelection|textOffset|r|isCursorPreceding|createRange|contains|compareDocumentPosition|previousSibling|collapse|d|k|focusNode|parent|anchorParent|StartToStart|supported|moveBoundary|getBoundary|focus|try|removeChild|removeAllRanges|setEndPoint|createTextRange|body|parentElement|EndToEnd|extend|catch|getChildIndex|moveToElementText|StartToEnd|nextSibling|length|insertBefore|compareEndPoints|while|a|createElement|focusOffset|0x02|nodeType|call|empty|select|anchorOffset|addRange|break|EndToStart|text|character|duplicate|moveEnd|moveStart|setStart|setEnd","replace","","\\w+","\\b","g"],RELANG,RLANG;eval(function(n,t,i,r,u,f){if(u=function(n){return n},!_0xf6db[5][_0xf6db[4]](/^/,String)){while(i--)f[i]=r[i]||i;r=[function(n){return f[n]}],u=function(){return _0xf6db[6]},i=1}while(i--)r[i]&&(n=n[_0xf6db[4]](new RegExp(_0xf6db[7]+u(i)+_0xf6db[7],_0xf6db[8]),r[i]));return n}(_0xf6db[0],10,108,_0xf6db[3][_0xf6db[2]](_0xf6db[1]),0,{})),typeof RELANG=="undefined"&&(RELANG={}),RLANG={html:"HTML",video:"Insert Video...",image:"Insert Image...",table:"Table",link:"Link",link_insert:"Insert Link ...",unlink:"Unlink",formatting:"Formatting",paragraph:"Paragraph",quote:"Quote",code:"Code",header1:"Header 1",header2:"Header 2",header3:"Header 3",header4:"Header 4",bold:"Bold",italic:"Italic",fontcolor:"Font Color",backcolor:"Back Color",unorderedlist:"Unordered List",orderedlist:"Ordered List",outdent:"Outdent",indent:"Indent",cancel:"Cancel",insert:"Insert",save:"Save",_delete:"Delete",insert_table:"Insert Table...",insert_row_above:"Add Row Above",insert_row_below:"Add Row Below",insert_column_left:"Add Column Left",insert_column_right:"Add Column Right",delete_column:"Delete Column",delete_row:"Delete Row",delete_table:"Delete Table",rows:"Rows",columns:"Columns",add_head:"Add Head",delete_head:"Delete Head",title:"Title",image_position:"Position",none:"None",left:"Left",right:"Right",image_web_link:"Image Web Link",text:"Text",mailto:"Email",web:"URL",video_html_code:"Video Embed Code",file:"Insert File...",upload:"Upload",download:"Download",choose:"Choose",or_choose:"Or choose",drop_file_here:"Drop file here",align_left:"Align Left",align_center:"Align Center",align_right:"Align Right",align_justify:"Justify",horizontalrule:"Insert Horizontal Rule",deleted:"Deleted",anchor:"Anchor",link_new_tab:"Open link in new tab"},function(n){jQuery.fn.redactor=function(i){return this.each(function(){var r=n(this),u=r.data("redactor");u||r.data("redactor",u=new t(this,i))})};var t=function(t,i){this.$el=n(t),typeof i!="undefined"&&typeof i.lang!="undefined"&&i.lang!=="en"&&typeof RELANG[i.lang]!="undefined"&&(RLANG=RELANG[i.lang]),this.opts=n.extend({lang:"en",direction:"ltr",callback:!1,keyupCallback:!1,keydownCallback:!1,execCommandCallback:!1,cleanup:!0,focus:!1,tabindex:!1,autoresize:!0,minHeight:!1,fixed:!1,fixedTop:0,fixedBox:!1,source:!0,shortcuts:!0,mobile:!0,air:!1,wym:!1,paragraphy:!0,convertLinks:!0,convertDivs:!0,protocol:"http://",autosave:!1,autosaveCallback:!1,interval:60,imageGetJson:!1,imageUpload:!1,imageUploadCallback:!1,fileUpload:!1,fileUploadCallback:!1,uploadCrossDomain:!1,uploadFields:!1,observeImages:!0,overlay:!0,allowedTags:["code","span","div","label","a","br","p","b","i","del","strike","u","img","video","audio","iframe","object","embed","param","blockquote","mark","cite","small","ul","ol","li","hr","dl","dt","dd","sup","sub","big","pre","code","figure","figcaption","strong","em","table","tr","td","th","tbody","thead","tfoot","h1","h2","h3","h4","h5","h6"],buttonsCustom:{},buttonsAdd:[],buttons:["html","|","formatting","|","bold","italic","deleted","|","unorderedlist","orderedlist","outdent","indent","|","image","video","file","table","link","|","fontcolor","backcolor","|","alignleft","aligncenter","alignright","justify","|","horizontalrule"],airButtons:["formatting","|","bold","italic","deleted","|","unorderedlist","orderedlist","outdent","indent","|","fontcolor","backcolor"],colors:["#ffffff","#000000","#eeece1","#1f497d","#4f81bd","#c0504d","#9bbb59","#8064a2","#4bacc6","#f79646","#ffff00","#f2f2f2","#7f7f7f","#ddd9c3","#c6d9f0","#dbe5f1","#f2dcdb","#ebf1dd","#e5e0ec","#dbeef3","#fdeada","#fff2ca","#d8d8d8","#595959","#c4bd97","#8db3e2","#b8cce4","#e5b9b7","#d7e3bc","#ccc1d9","#b7dde8","#fbd5b5","#ffe694","#bfbfbf","#3f3f3f","#938953","#548dd4","#95b3d7","#d99694","#c3d69b","#b2a2c7","#b7dde8","#fac08f","#f2c314","#a5a5a5","#262626","#494429","#17365d","#366092","#953734","#76923c","#5f497a","#92cddc","#e36c09","#c09100","#7f7f7f","#0c0c0c","#1d1b10","#0f243e","#244061","#632423","#4f6128","#3f3151","#31859b","#974806","#7f6000"],allEmptyHtml:"<p><br /><\/p>",mozillaEmptyHtml:"<p>&nbsp;<\/p>",buffer:!1,visual:!0,modal_file:String()+'<form id="redactorUploadFileForm" method="post" action="" enctype="multipart/form-data"><label>Name (optional)<\/label><input type="text" id="redactor_filename" class="redactor_input" /><div style="margin-top: 7px;"><input type="file" id="redactor_file" name="file" /><\/div><\/form>',modal_image_edit:String()+"<label>"+RLANG.title+'<\/label><input id="redactor_file_alt" class="redactor_input" /><label>'+RLANG.link+'<\/label><input id="redactor_file_link" class="redactor_input" /><label>'+RLANG.image_position+'<\/label><select id="redactor_form_image_align"><option value="none">'+RLANG.none+'<\/option><option value="left">'+RLANG.left+'<\/option><option value="right">'+RLANG.right+'<\/option><\/select><div id="redactor_modal_footer"><a href="javascript:void(null);" id="redactor_image_delete_btn" style="color: #000;">'+RLANG._delete+'<\/a><span class="redactor_btns_box"><input type="button" name="save" id="redactorSaveBtn" value="'+RLANG.save+'" /><a href="javascript:void(null);" id="redactor_btn_modal_close">'+RLANG.cancel+"<\/a><\/span><\/div>",modal_image:String()+'<div id="redactor_tabs"><a href="javascript:void(null);" class="redactor_tabs_act">'+RLANG.upload+'<\/a><a href="javascript:void(null);">'+RLANG.choose+'<\/a><a href="javascript:void(null);">'+RLANG.link+'<\/a><\/div><form id="redactorInsertImageForm" method="post" action="" enctype="multipart/form-data"><div id="redactor_tab1" class="redactor_tab"><input type="file" id="redactor_file" name="file" /><\/div><div id="redactor_tab2" class="redactor_tab" style="display: none;"><div id="redactor_image_box"><\/div><\/div><\/form><div id="redactor_tab3" class="redactor_tab" style="display: none;"><label>'+RLANG.image_web_link+'<\/label><input name="redactor_file_link" id="redactor_file_link" class="redactor_input"  /><\/div><div id="redactor_modal_footer"><span class="redactor_btns_box"><input type="button" name="upload" id="redactor_upload_btn" value="'+RLANG.insert+'" /><a href="javascript:void(null);" id="redactor_btn_modal_close">'+RLANG.cancel+"<\/a><\/span><\/div>",modal_link:String()+'<form id="redactorInsertLinkForm" method="post" action=""><div id="redactor_tabs"><a href="javascript:void(null);" class="redactor_tabs_act">URL<\/a><a href="javascript:void(null);">Email<\/a><a href="javascript:void(null);">'+RLANG.anchor+'<\/a><\/div><input type="hidden" id="redactor_tab_selected" value="1" /><div class="redactor_tab" id="redactor_tab1"><label>URL<\/label><input id="redactor_link_url" class="redactor_input"  /><label>'+RLANG.text+'<\/label><input class="redactor_input redactor_link_text" id="redactor_link_url_text" /><label><input type="checkbox" id="redactor_link_blank"> '+RLANG.link_new_tab+'<\/div><div class="redactor_tab" id="redactor_tab2" style="display: none;"><label>Email<\/label><input id="redactor_link_mailto" class="redactor_input" /><label>'+RLANG.text+'<\/label><input class="redactor_input redactor_link_text" id="redactor_link_mailto_text" /><\/div><div class="redactor_tab" id="redactor_tab3" style="display: none;"><label>'+RLANG.anchor+'<\/label><input class="redactor_input" id="redactor_link_anchor"  /><label>'+RLANG.text+'<\/label><input class="redactor_input redactor_link_text" id="redactor_link_anchor_text" /><\/div><\/form><div id="redactor_modal_footer"><span class="redactor_btns_box"><input type="button" id="redactor_insert_link_btn" value="'+RLANG.insert+'" /><a href="javascript:void(null);" id="redactor_btn_modal_close">'+RLANG.cancel+"<\/a><\/span><\/div>",modal_table:String()+"<label>"+RLANG.rows+'<\/label><input size="5" value="2" id="redactor_table_rows" /><label>'+RLANG.columns+'<\/label><input size="5" value="3" id="redactor_table_columns" /><div id="redactor_modal_footer"><span class="redactor_btns_box"><input type="button" name="upload" id="redactor_insert_table_btn" value="'+RLANG.insert+'" /><a href="javascript:void(null);" id="redactor_btn_modal_close">'+RLANG.cancel+"<\/a><\/span><\/div>",modal_video:String()+'<form id="redactorInsertVideoForm"><label>'+RLANG.video_html_code+'<\/label><textarea id="redactor_insert_video_area" style="width: 99%; height: 160px;"><\/textarea><\/form><div id="redactor_modal_footer"><span class="redactor_btns_box"><input type="button" id="redactor_insert_video_btn" value="'+RLANG.insert+'" /><a href="javascript:void(null);" id="redactor_btn_modal_close">'+RLANG.cancel+"<\/a><\/span><\/div>",toolbar:{html:{title:RLANG.html,func:"toggle"},formatting:{title:RLANG.formatting,func:"show",dropdown:{p:{title:RLANG.paragraph,exec:"formatblock"},blockquote:{title:RLANG.quote,exec:"formatblock",className:"redactor_format_blockquote"},pre:{title:RLANG.code,exec:"formatblock",className:"redactor_format_pre"},h1:{title:RLANG.header1,exec:"formatblock",className:"redactor_format_h1"},h2:{title:RLANG.header2,exec:"formatblock",className:"redactor_format_h2"},h3:{title:RLANG.header3,exec:"formatblock",className:"redactor_format_h3"},h4:{title:RLANG.header4,exec:"formatblock",className:"redactor_format_h4"}}},bold:{title:RLANG.bold,exec:"bold"},italic:{title:RLANG.italic,exec:"italic"},deleted:{title:RLANG.deleted,exec:"strikethrough"},unorderedlist:{title:"&bull; "+RLANG.unorderedlist,exec:"insertunorderedlist"},orderedlist:{title:"1. "+RLANG.orderedlist,exec:"insertorderedlist"},outdent:{title:"< "+RLANG.outdent,exec:"outdent"},indent:{title:"> "+RLANG.indent,exec:"indent"},image:{title:RLANG.image,func:"showImage"},video:{title:RLANG.video,func:"showVideo"},file:{title:RLANG.file,func:"showFile"},table:{title:RLANG.table,func:"show",dropdown:{insert_table:{title:RLANG.insert_table,func:"showTable"},separator_drop1:{name:"separator"},insert_row_above:{title:RLANG.insert_row_above,func:"insertRowAbove"},insert_row_below:{title:RLANG.insert_row_below,func:"insertRowBelow"},insert_column_left:{title:RLANG.insert_column_left,func:"insertColumnLeft"},insert_column_right:{title:RLANG.insert_column_right,func:"insertColumnRight"},separator_drop2:{name:"separator"},add_head:{title:RLANG.add_head,func:"addHead"},delete_head:{title:RLANG.delete_head,func:"deleteHead"},separator_drop3:{name:"separator"},delete_column:{title:RLANG.delete_column,func:"deleteColumn"},delete_row:{title:RLANG.delete_row,func:"deleteRow"},delete_table:{title:RLANG.delete_table,func:"deleteTable"}}},link:{title:RLANG.link,func:"show",dropdown:{link:{title:RLANG.link_insert,func:"showLink"},unlink:{title:RLANG.unlink,exec:"unlink"}}},fontcolor:{title:RLANG.fontcolor,func:"show"},backcolor:{title:RLANG.backcolor,func:"show"},alignleft:{exec:"JustifyLeft",title:RLANG.align_left},aligncenter:{exec:"JustifyCenter",title:RLANG.align_center},alignright:{exec:"JustifyRight",title:RLANG.align_right},justify:{exec:"justifyfull",title:RLANG.align_justify},horizontalrule:{exec:"inserthorizontalrule",title:RLANG.horizontalrule}}},i,this.$el.data()),this.dropdowns=[],this.init()};t.prototype={init:function(){var t,i,r,u;if(this.height=this.$el.css("height"),this.width=this.$el.css("width"),this.opts.mobile===!1&&this.isMobile())return this.build(!0),!1;this.opts.paragraphy===!1&&(this.opts.convertDivs=!1),this.opts.air?this.opts.buttons=this.opts.airButtons:this.opts.toolbar!==!1&&(this.opts.source===!1&&(t=this.opts.buttons.indexOf("html"),i=this.opts.buttons[t+1],this.opts.buttons.splice(t,1),typeof i!="undefined"&&i==="|"&&this.opts.buttons.splice(t,1)),n.extend(this.opts.toolbar,this.opts.buttonsCustom),n.each(this.opts.buttonsAdd,n.proxy(function(n,t){this.opts.buttons.push(t)},this))),this.build(),this.enableAir(),this.buildToolbar(),r=!1,n.browser.webkit&&navigator.userAgent.indexOf("Chrome")===-1&&(u=n.browser.version.split("."),u[0]<536&&(r=!0)),this.isMobile(!0)===!1&&r===!1&&this.$editor.bind("paste",n.proxy(function(){if(this.opts.cleanup===!1)return!0;this.setBuffer(),this.saveScroll=this.opts.autoresize===!0?document.body.scrollTop:this.$editor.scrollTop();var t=this.extractContent();setTimeout(n.proxy(function(){var i=this.extractContent(),n;this.$editor.append(t),this.restoreSelection(),n=this.getFragmentHtml(i),this.pasteCleanUp(n)},this),1)},this)),this.keyup(),this.keydown(),this.opts.autosave!==!1&&this.autoSave(),this.observeImages(),this.observeTables(),n.browser.mozilla&&(document.execCommand("enableObjectResizing",!1,!1),document.execCommand("enableInlineTableEditing",!1,!1)),this.opts.focus&&this.$editor.focus(),this.opts.fixed&&(this.observeScroll(),n(document).scroll(n.proxy(this.observeScroll,this))),typeof this.opts.callback=="function"&&this.opts.callback(this)},shortcuts:function(n,t){n.preventDefault(),this.execCommand(t,!1)},keyup:function(){this.$editor.keyup(n.proxy(function(t){var i=t.keyCode||t.which;if(typeof this.opts.keyupCallback=="function"&&this.opts.keyupCallback(this,t),i===8||i===46)return this.observeImages(),this.formatEmpty(t);i!==13||t.shiftKey||t.ctrlKey||t.metaKey||(n.browser.webkit&&this.opts.paragraphy&&this.formatNewLine(t),this.opts.convertLinks&&this.$editor.linkify()),this.syncCode()},this))},keydown:function(){this.$editor.keydown(n.proxy(function(t){var i=t.keyCode||t.which,u=this.getParentNode(),r=!1,f=t.ctrlKey||t.metaKey;return(u&&n(u).get(0).tagName==="PRE"&&(r=!0),typeof this.opts.keydownCallback=="function"&&this.opts.keydownCallback(this,t),this.opts.paragraphy===!1&&n.browser.webkit&&i===13&&!t.shiftKey&&!t.ctrlKey&&!t.metaKey)?(t.preventDefault(),this.insertNodeAtCaret(n('<span class="redactor-breakline"><br><\/span>').get(0)),setTimeout(n.proxy(function(){this.$editor.find("span.redactor-breakline").replaceWith("<br>"),setTimeout(n.proxy(function(){this.syncCode()},this),10)},this),10),!1):(f&&this.opts.shortcuts&&(i===90?this.opts.buffer!==!1?(t.preventDefault(),this.getBuffer()):t.shiftKey?this.shortcuts(t,"redo"):this.shortcuts(t,"undo"):i===77?this.shortcuts(t,"removeFormat"):i===66?this.shortcuts(t,"bold"):i===73?this.shortcuts(t,"italic"):i===74?this.shortcuts(t,"insertunorderedlist"):i===75?this.shortcuts(t,"insertorderedlist"):i===76?this.shortcuts(t,"superscript"):i===72&&this.shortcuts(t,"subscript")),f||i===90||(this.opts.buffer=!1),r===!0&&i===13&&(t.preventDefault(),this.insertNodeAtCaret(document.createTextNode("\r\n"))),this.opts.shortcuts&&!t.shiftKey&&i===9?r===!1?this.shortcuts(t,"indent"):(t.preventDefault(),this.insertNodeAtCaret(document.createTextNode("\t"))):this.opts.shortcuts&&t.shiftKey&&i===9&&this.shortcuts(t,"outdent"),n.browser.webkit&&navigator.userAgent.indexOf("Chrome")===-1?this.safariShiftKeyEnter(t,i):void 0)},this))},build:function(t){var i,r;t!==!0?(this.$box=n('<div class="redactor_box"><\/div>'),this.opts.air&&(this.air=n('<div class="redactor_air" style="display: none;"><\/div>')),this.textareamode=!0,this.$el.get(0).tagName==="TEXTAREA"?this.$editor=n("<div><\/div>"):(this.textareamode=!1,this.$editor=this.$el,this.$el=n('<textarea name="'+this.$editor.attr("id")+'"><\/textarea>').css("height",this.height)),this.$editor.addClass("redactor_editor").attr("contenteditable",!0).attr("dir",this.opts.direction),this.opts.tabindex!==!1&&this.$editor.attr("tabindex",this.opts.tabindex),this.opts.minHeight!==!1&&this.$editor.css("min-height",this.opts.minHeight+"px"),this.opts.wym===!0&&this.$editor.addClass("redactor_editor_wym"),this.opts.autoresize===!1&&this.$editor.css("height",this.height),this.$el.hide(),i="",this.textareamode?(i=this.$el.val(),this.$box.insertAfter(this.$el).append(this.$editor).append(this.$el)):(i=this.$editor.html(),this.$box.insertAfter(this.$editor).append(this.$el).append(this.$editor)),i=this.opts.paragraphy?this.paragraphy(i):i.replace(/<p>([\w\W]*?)<\/p>/gi,"$1<br><br>"),this.$editor.html(i),this.textareamode===!1&&this.syncCode()):this.$el.get(0).tagName!=="TEXTAREA"&&(i=this.$el.val(),r=n('<textarea name="'+this.$editor.attr("id")+'"><\/textarea>').css("height",this.height).val(i),this.$el.hide(),this.$el.after(r))},enableAir:function(){if(this.opts.air===!1)return!1;this.air.hide(),this.$editor.bind("textselect",n.proxy(function(n){this.showAir(n)},this)),this.$editor.bind("textunselect",n.proxy(function(){this.air.hide()},this))},showAir:function(t){n(".redactor_air").hide();var r=this.air.innerWidth(),i=t.clientX;n(document).width()<i+r&&(i=i-r),this.air.css({left:i+"px",top:t.clientY+n(document).scrollTop()+14+"px"}).show()},syncCode:function(){this.$el.val(this.$editor.html())},setCode:function(n){this.$editor.html(n).focus(),this.syncCode()},getCode:function(){return this.opts.visual?this.$editor.html():this.$el.val()},insertHtml:function(n){this.$editor.focus(),this.execCommand("inserthtml",n),this.observeImages()},destroy:function(){var i=this.getCode(),t;for(this.textareamode?(this.$box.after(this.$el),this.$box.remove(),this.$el.height(this.height).val(i).show()):(this.$box.after(this.$editor),this.$box.remove(),this.$editor.removeClass("redactor_editor").removeClass("redactor_editor_wym").attr("contenteditable",!1).html(i).show()),n(".redactor_air").remove(),t=0;t<this.dropdowns.length;t++)this.dropdowns[t].remove(),delete this.dropdowns[t]},observeImages:function(){if(this.opts.observeImages===!1)return!1;this.$editor.find("img").each(n.proxy(function(t,i){n.browser.msie&&n(i).attr("unselectable","on"),this.resizeImage(i)},this))},observeTables:function(){this.$editor.find("table").click(n.proxy(this.tableObserver,this))},observeScroll:function(){var r=n(document).scrollTop(),u=this.$box.offset().top,t=0,i;r>u?(i="100%",this.opts.fixedBox&&(t=this.$editor.offset().left,i=this.$editor.innerWidth()),this.fixed=!0,this.$toolbar.css({position:"fixed",width:i,zIndex:100,top:this.opts.fixedTop+"px",left:t})):(this.fixed=!1,this.$toolbar.css({position:"relative",width:"auto",zIndex:1,top:0,left:t}))},setBuffer:function(){this.saveSelection(),this.opts.buffer=this.$editor.html()},getBuffer:function(){if(this.opts.buffer===!1)return!1;this.$editor.html(this.opts.buffer),n.browser.msie||this.restoreSelection(),this.opts.buffer=!1},execCommand:function(t,i){var r,u,f;if(this.opts.visual==!1)return this.$el.focus(),!1;try{t==="inserthtml"&&n.browser.msie?(this.$editor.is(":focus")||this.$editor.focus(),document.selection.createRange().pasteHTML(i)):t==="formatblock"&&n.browser.msie?document.execCommand(t,!1,"<"+i+">"):t==="unlink"?(r=this.getParentNode(),n(r).get(0).tagName==="A"?n(r).replaceWith(n(r).text()):document.execCommand(t,!1,i)):t==="formatblock"&&i==="blockquote"?(r=this.getParentNode(),n(r).get(0).tagName==="BLOCKQUOTE"?document.execCommand(t,!1,"p"):n(r).get(0).tagName==="P"?(u=n(r).parent(),n(u).get(0).tagName==="BLOCKQUOTE"?(f=n("<p>"+n(r).html()+"<\/p>"),n(u).replaceWith(f),this.setFocusNode(f.get(0))):document.execCommand(t,!1,i)):document.execCommand(t,!1,i)):t==="formatblock"&&i==="pre"?(r=this.getParentNode(),n(r).get(0).tagName==="PRE"?n(r).replaceWith("<p>"+n(r).text()+"<\/p>"):document.execCommand(t,!1,i)):document.execCommand(t,!1,i),t==="inserthorizontalrule"&&this.$editor.find("hr").removeAttr("id"),this.syncCode(),this.oldIE()&&this.$editor.focus(),typeof this.opts.execCommandCallback=="function"&&this.opts.execCommandCallback(this,t),this.opts.air&&this.air.hide()}catch(e){}},formatNewLine:function(){var r=this.getParentNode(),t,i;r.nodeName==="DIV"&&r.className==="redactor_editor"&&(t=n(this.getCurrentNode()),t.get(0).tagName==="DIV"&&(t.html()===""||t.html()==="<br>")&&(i=n("<p>").append(t.clone().get(0).childNodes),t.replaceWith(i),i.html("<br />"),this.setFocusNode(i.get(0))))},safariShiftKeyEnter:function(t,i){return t.shiftKey&&i===13?(t.preventDefault(),this.insertNodeAtCaret(n("<span><br /><\/span>").get(0)),this.syncCode(),!1):!0},formatEmpty:function(t){var i=n.trim(this.$editor.html()),r,u;if(n.browser.mozilla&&(i=i.replace(/<br>/i,"")),i==="")return t.preventDefault(),r=this.opts.allEmptyHtml,n.browser.mozilla&&(r=this.opts.mozillaEmptyHtml),u=n(r).get(0),this.$editor.html(u),this.setFocusNode(u),this.syncCode(),!1;this.syncCode()},paragraphy:function(t){if(t=n.trim(t),t==="")return n.browser.mozilla?this.opts.mozillaEmptyHtml:this.opts.allEmptyHtml;this.opts.convertDivs&&(t=t.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,"<p>$2<\/p>"));var u=function(n,t,i){return n.replace(new RegExp(t,"g"),i)},i=function(n,i){return u(t,n,i)},r="(table|thead|tfoot|caption|colgroup|tbody|tr|td|th|div|dl|dd|dt|ul|ol|li|pre|select|form|blockquote|address|math|style|script|object|input|param|p|h[1-6])";return t+="\n",i("<br />\\s*<br />","\n\n"),i("(<"+r+"[^>]*>)","\n$1"),i("(<\/"+r+">)","$1\n\n"),i("\r\n|\r","\n"),i("\n\n+","\n\n"),i("\n?((.|\n)+?)$","<p>$1<\/p>\n"),i("<p>\\s*?<\/p>",""),i("<p>(<div[^>]*>\\s*)","$1<p>"),i("<p>([^<]+)\\s*?(<\/(div|address|form)[^>]*>)","<p>$1<\/p>$2"),i("<p>\\s*(<\/?"+r+"[^>]*>)\\s*<\/p>","$1"),i("<p>(<li.+?)<\/p>","$1"),i("<p>\\s*(<\/?"+r+"[^>]*>)","$1"),i("(<\/?"+r+"[^>]*>)\\s*<\/p>","$1"),i("(<\/?"+r+"[^>]*>)\\s*<br />","$1"),i("<br />(\\s*<\/?(p|li|div|dl|dd|dt|th|pre|td|ul|ol)[^>]*>)","$1"),t.indexOf("<pre")!=-1&&i("(<pre(.|\n)*?>)((.|\n)*?)<\/pre>",function(n,t,i,r){return u(t,"\\\\(['\"\\\\])","$1")+u(u(u(r,"<p>","\n"),"<\/p>|<br />",""),"\\\\(['\"\\\\])","$1")+"<\/pre>"}),i("\n<\/p>$","<\/p>")},stripTags:function(t){var i=this.opts.allowedTags;return t.replace(/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,function(t,r){return n.inArray(r.toLowerCase(),i)>"-1"?t:""})},pasteCleanUp:function(t){t=t.replace(/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi,""),t=t.replace(/(&nbsp;){1,}/gi,"&nbsp;"),t=t.replace(/<b\sid="internal-source-marker(.*?)">([\w\W]*?)<\/b>/gi,"$2"),t=this.stripTags(t),t=t.replace(/<td><br><\/td>/gi,"[td]"),t=t.replace(/<a(.*?)>([\w\W]*?)<\/a>/gi,"[a$1]$2[/a]"),t=t.replace(/<iframe(.*?)>([\w\W]*?)<\/iframe>/gi,"[iframe$1]$2[/iframe]"),t=t.replace(/<video(.*?)>([\w\W]*?)<\/video>/gi,"[video$1]$2[/video]"),t=t.replace(/<audio(.*?)>([\w\W]*?)<\/audio>/gi,"[audio$1]$2[/audio]"),t=t.replace(/<embed(.*?)>([\w\W]*?)<\/embed>/gi,"[embed$1]$2[/embed]"),t=t.replace(/<object(.*?)>([\w\W]*?)<\/object>/gi,"[object$1]$2[/object]"),t=t.replace(/<param(.*?)>/gi,"[param$1]"),t=t.replace(/<img(.*?)>/gi,"[img$1]"),t=t.replace(/<(\w+)([\w\W]*?)>/gi,"<$1>"),t=t.replace(/<[^\/>][^>]*>(\s*|\t*|\n*|&nbsp;|<br>)<\/[^>]+>/gi,""),t=t.replace(/<[^\/>][^>]*>(\s*|\t*|\n*|&nbsp;|<br>)<\/[^>]+>/gi,""),t=t.replace(/\[td\]/gi,"<td><br><\/td>"),t=t.replace(/\[a(.*?)\]([\w\W]*?)\[\/a\]/gi,"<a$1>$2<\/a>"),t=t.replace(/\[iframe(.*?)\]([\w\W]*?)\[\/iframe\]/gi,"<iframe$1>$2<\/iframe>"),t=t.replace(/\[video(.*?)\]([\w\W]*?)\[\/video\]/gi,"<video$1>$2<\/video>"),t=t.replace(/\[audio(.*?)\]([\w\W]*?)\[\/audio\]/gi,"<audio$1>$2<\/audio>"),t=t.replace(/\[embed(.*?)\]([\w\W]*?)\[\/embed\]/gi,"<embed$1>$2<\/embed>"),t=t.replace(/\[object(.*?)\]([\w\W]*?)\[\/object\]/gi,"<object$1>$2<\/object>"),t=t.replace(/\[param(.*?)\]/gi,"<param$1>"),t=t.replace(/\[img(.*?)\]/gi,"<img$1>"),this.opts.convertDivs&&(t=t.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,"<p>$2<\/p>")),this.opts.paragraphy===!1&&(t=t.replace(/<p>([\w\W]*?)<\/p>/gi,"$1<br>")),t=t.replace(/<span>([\w\W]*?)<\/span>/gi,"$1"),t=t.replace(/\n{3,}/gi,"\n"),t=t.replace(/<p><p>/g,"<p>"),t=t.replace(/<\/p><\/p>/g,"<\/p>"),this.execCommand("inserthtml",t),this.opts.autoresize===!0?n(document.body).scrollTop(this.saveScroll):this.$editor.scrollTop(this.saveScroll)},formattingRemove:function(t){var i=[],r=t.match(/<pre(.*?)>([\w\W]*?)<\/pre>/gi);return r!==null&&n.each(r,function(n,r){t=t.replace(r,"prebuffer_"+n),i.push(r)}),t=t.replace(/\s{2,}/g," "),t=t.replace(/\n/g," "),t=t.replace(/[\t]*/g,""),t=t.replace(/\n\s*\n/g,"\n"),t=t.replace(/^[\s\n]*/g,""),t=t.replace(/[\s\n]*$/g,""),t=t.replace(/>\s+</g,"><"),i&&(n.each(i,function(n,i){t=t.replace("prebuffer_"+n,i)}),i=[]),t},formattingIndenting:function(n){return n=n.replace(/<li/g,"\t<li"),n=n.replace(/<tr/g,"\t<tr"),n=n.replace(/<td/g,"\t\t<td"),n.replace(/<\/tr>/g,"\t<\/tr>")},formattingEmptyTags:function(n){for(var i=["<pre><\/pre>","<blockquote>\\s*<\/blockquote>","<em>\\s*<\/em>","<ul><\/ul>","<ol><\/ol>","<li><\/li>","<table><\/table>","<tr><\/tr>","<span>\\s*<span>","<span>&nbsp;<span>","<b>\\s*<\/b>","<b>&nbsp;<\/b>","<p>\\s*<\/p>","<p>&nbsp;<\/p>","<p>\\s*<br>\\s*<\/p>","<div>\\s*<\/div>","<div>\\s*<br>\\s*<\/div>"],r,t=0;t<i.length;++t)r=i[t],n=n.replace(new RegExp(r,"gi"),"");return n},formattingAddBefore:function(n){for(var r=["<p","<form","<\/ul>","<\/ol>","<fieldset","<legend","<object","<embed","<select","<option","<input","<textarea","<pre","<blockquote","<ul","<ol","<li","<dl","<dt","<dd","<table","<thead","<tbody","<caption","<\/caption>","<th","<tr","<td","<figure"],i,t=0;t<r.length;++t)i=r[t],n=n.replace(new RegExp(i,"gi"),"\r\n"+i);return n},formattingAddAfter:function(n){for(var r=["<\/p>","<\/div>","<\/h1>","<\/h2>","<\/h3>","<\/h4>","<\/h5>","<\/h6>","<br>","<br />","<\/dl>","<\/dt>","<\/dd>","<\/form>","<\/blockquote>","<\/pre>","<\/legend>","<\/fieldset>","<\/object>","<\/embed>","<\/textarea>","<\/select>","<\/option>","<\/table>","<\/thead>","<\/tbody>","<\/tr>","<\/td>","<\/th>","<\/figure>"],i,t=0;t<r.length;++t)i=r[t],n=n.replace(new RegExp(i,"gi"),i+"\r\n");return n},formatting:function(n){return n=this.formattingRemove(n),n=this.formattingEmptyTags(n),n=this.formattingAddBefore(n),n=this.formattingAddAfter(n),this.formattingIndenting(n)},toggle:function(){var t;this.opts.visual?(this.$editor.hide(),t=this.$editor.html(),t=n.trim(this.formatting(t)),this.$el.height(this.$editor.innerHeight()).val(t).show().focus(),this.setBtnActive("html"),this.opts.visual=!1):(this.$el.hide(),t=this.stripTags(this.$el.val()),this.$editor.html(t),this.$editor.show(),this.$editor.html()===""&&(t=n.browser.mozilla?this.opts.mozillaEmptyHtml:this.opts.allEmptyHtml,this.setCode(t)),this.$editor.focus(),this.setBtnInactive("html"),this.opts.visual=!0,this.observeImages(),this.observeTables())},autoSave:function(){setInterval(n.proxy(function(){n.ajax({url:this.opts.autosave,type:"post",data:this.$el.attr("name")+"="+this.getCode(),success:n.proxy(function(n){typeof this.opts.autosaveCallback=="function"&&this.opts.autosaveCallback(n,this)},this)})},this),this.opts.interval*1e3)},buildToolbar:function(){if(this.opts.toolbar===!1)return!1;this.$toolbar=n("<ul>").addClass("redactor_toolbar"),this.opts.air?(n(this.air).append(this.$toolbar),n("body").prepend(this.air)):this.$box.prepend(this.$toolbar),n.each(this.opts.buttons,n.proxy(function(t,i){var u,e,f,r;if(i!=="|"&&typeof this.opts.toolbar[i]!="undefined"){if(u=this.opts.toolbar[i],this.opts.fileUpload===!1&&i==="file")return!0;e=n("<li>"),f=this.buildButton(i,u),(i==="backcolor"||i==="fontcolor"||typeof u.dropdown!="undefined")&&(r=n('<div class="redactor_dropdown" style="display: none;">'),r=i==="backcolor"||i==="fontcolor"?this.buildColorPicker(r,i):this.buildDropdown(r,u.dropdown),this.dropdowns.push(r.appendTo(n(document.body))),this.hdlHideDropDown=n.proxy(function(n){this.hideDropDown(n,r,i)},this),this.hdlShowDropDown=n.proxy(function(n){this.showDropDown(n,r,i)},this),f.click(this.hdlShowDropDown)),this.$toolbar.append(n(e).append(f))}i==="|"&&this.$toolbar.append(n('<li class="redactor_separator"><\/li>'))},this)),n(document).click(this.hdlHideDropDown),this.$editor.click(this.hdlHideDropDown)},buildButton:function(t,i){var r=n('<a href="javascript:void(null);" title="'+i.title+'" class="redactor_btn_'+t+'"><\/a>');return typeof i.func=="undefined"?r.click(n.proxy(function(){this.execCommand(i.exec,t)},this)):i.func!=="show"&&r.click(n.proxy(function(n){this[i.func](n)},this)),typeof i.callback!="undefined"&&r.click(n.proxy(function(n){i.callback(this,n,t)},this)),r},buildDropdown:function(t,i){return n.each(i,n.proxy(function(i,r){typeof r.className=="undefined"&&(r.className="");var u;typeof r.name!="undefined"&&r.name==="separator"?u=n('<a class="redactor_separator_drop">'):(u=n('<a href="javascript:void(null);" class="'+r.className+'">'+r.title+"<\/a>"),typeof r.func=="undefined"?n(u).click(n.proxy(function(){this.execCommand(r.exec,i)},this)):n(u).click(n.proxy(function(n){this[r.func](n)},this))),n(t).append(u)},this)),t},buildColorPicker:function(t,i){var r,h,u,o,s,f,e;for(r=i==="backcolor"?n.browser.msie?"BackColor":"hilitecolor":"forecolor",n(t).width(210),h=this.opts.colors.length,u=0;u<h;++u)o=this.opts.colors[u],s=n('<a rel="'+o+'" href="javascript:void(null);" class="redactor_color_link"><\/a>').css({backgroundColor:o}),n(t).append(s),f=this,n(s).click(function(){f.execCommand(r,n(this).attr("rel")),r==="forecolor"&&f.$editor.find("font").replaceWith(function(){return n('<span style="color: '+n(this).attr("color")+';">'+n(this).html()+"<\/span>")}),n.browser.msie&&r==="BackColor"&&f.$editor.find("font").replaceWith(function(){return n('<span style="'+n(this).attr("style")+'">'+n(this).html()+"<\/span>")})});return e=n('<a href="javascript:void(null);" class="redactor_color_none"><\/a>').html(RLANG.none),i==="backcolor"?e.click(n.proxy(this.setBackgroundNone,this)):e.click(n.proxy(this.setColorNone,this)),n(t).append(e),t},setBackgroundNone:function(){n(this.getParentNode()).css("background-color","transparent"),this.syncCode()},setColorNone:function(){n(this.getParentNode()).attr("color","").css("color",""),this.syncCode()},showDropDown:function(t,i,r){var u,f,e;this.getBtn(r).hasClass("dropact")?this.hideAllDropDown():(this.hideAllDropDown(),this.setBtnActive(r),this.getBtn(r).addClass("dropact"),u=this.getBtn(r).offset().left,this.opts.air?(f=this.air.offset().top,n(i).css({position:"absolute",left:u+"px",top:f+30+"px"}).show()):this.opts.fixed&&this.fixed?n(i).css({position:"fixed",left:u+"px",top:"30px"}).show():(e=this.$toolbar.offset().top+30,n(i).css({position:"absolute",left:u+"px",top:e+"px"}).show()))},hideAllDropDown:function(){this.$toolbar.find("a.dropact").removeClass("act").removeClass("dropact"),n(".redactor_dropdown").hide()},hideDropDown:function(t,i){n(t.target).hasClass("dropact")||(n(i).removeClass("act"),this.showedDropDown=!1,this.hideAllDropDown())},getSelection:function(){return typeof window.getSelection!="undefined"?document.getSelection():typeof document.selection!="undefined"?document.selection.createRange():void 0},getFragmentHtml:function(n){var i=n.cloneNode(!0),t=document.createElement("div");return t.appendChild(i),t.innerHTML},extractContent:function(){for(var i=this.$editor.get(0),n=document.createDocumentFragment(),t;t=i.firstChild;)n.appendChild(t);return n},saveSelection:function(){if(this.savedSel=null,this.savedSelObj=null,n.browser.msie&&parseInt(n.browser.version,10)<9){var t=this.$editor.get(0);this.savedSel=window.Selection.getOrigin(t),this.savedSelObj=window.Selection.getFocus(t)}else this.savedSel=window.Selection.getOrigin(window),this.savedSelObj=window.Selection.getFocus(window)},restoreSelection:function(){this.savedSel!==null&&this.savedSelObj!==null&&this.savedSel[0].tagName!=="BODY"?n(this.savedSel[0]).closest(".redactor_editor").size()==0?this.$editor.focus():window.Selection.setSelection(window,this.savedSel[0],this.savedSel[1],this.savedSelObj[0],this.savedSelObj[1]):this.$editor.focus()},getParentNode:function(){if(typeof window.getSelection!="undefined"){var n=window.getSelection();return n.rangeCount>0?this.getSelection().getRangeAt(0).startContainer.parentNode:!1}if(typeof document.selection!="undefined")return this.getSelection().parentElement()},getCurrentNode:function(){return typeof window.getSelection!="undefined"?this.getSelection().getRangeAt(0).startContainer:typeof document.selection!="undefined"?this.getSelection():void 0},setFocusNode:function(n){if(typeof n=="undefined")return!1;try{var i=document.createRange(),t=this.getSelection();t!==null&&(i.selectNodeContents(n),t.addRange(i),t.collapse(n,0)),this.$editor.focus()}catch(r){}},insertNodeAtCaret:function(n){var i,t,f,e,r,u;window.getSelection?(i=this.getSelection(),i.rangeCount&&(t=i.getRangeAt(0),t.collapse(!1),t.insertNode(n),t=t.cloneRange(),t.selectNodeContents(n),t.collapse(!1),i.removeAllRanges(),i.addRange(t))):document.selection&&(f=n.nodeType===1?n.outerHTML:n.data,e="marker_"+(""+Math.random()).slice(2),f+='<span id="'+e+'"><\/span>',r=this.getSelection(),r.collapse(!1),r.pasteHTML(f),u=document.getElementById(e),r.moveToElementText(u),r.select(),u.parentNode.removeChild(u))},getSelectedHtml:function(){var i="",n,r,t,u;if(window.getSelection){if(n=window.getSelection(),n.rangeCount){for(r=document.createElement("div"),t=0,u=n.rangeCount;t<u;++t)r.appendChild(n.getRangeAt(t).cloneContents());i=r.innerHTML}}else document.selection&&document.selection.type==="Text"&&(i=document.selection.createRange().htmlText);return i},getBtn:function(t){return n(this.$toolbar.find("a.redactor_btn_"+t))},setBtnActive:function(n){this.getBtn(n).addClass("act")},setBtnInactive:function(n){this.getBtn(n).removeClass("act")},resizeImage:function(t){var i=!1,r=!1,u,f,e=n(t).width()/n(t).height(),o=10,s=10;n(t).hover(function(){n(t).css("cursor","nw-resize")},function(){n(t).css("cursor","default"),i=!1}),n(t).mousedown(function(o){o.preventDefault(),e=n(t).width()/n(t).height(),i=!0,r=!0,u=Math.round(o.pageX-n(t).eq(0).offset().left),f=Math.round(o.pageY-n(t).eq(0).offset().top)}),n(t).mouseup(n.proxy(function(){i=!1,this.syncCode()},this)),n(t).click(n.proxy(function(n){r&&this.imageEdit(n)},this)),n(t).mousemove(function(h){if(i){r=!1;var y=Math.round(h.pageX-n(this).eq(0).offset().left)-u,a=Math.round(h.pageY-n(this).eq(0).offset().top)-f,v=n(t).height(),c=parseInt(v,10)+a,l=c*e;l>o&&n(t).width(l),c>s&&n(t).height(c),u=Math.round(h.pageX-n(this).eq(0).offset().left),f=Math.round(h.pageY-n(this).eq(0).offset().top)}})},showTable:function(){this.saveSelection(),this.modalInit(RLANG.table,"table",300,n.proxy(function(){n("#redactor_insert_table_btn").click(n.proxy(this.insertTable,this))},this),function(){n("#redactor_table_rows").focus()})},insertTable:function(){for(var s=n("#redactor_table_rows").val(),h=n("#redactor_table_columns").val(),u=n("<div><\/div>"),c=Math.floor(Math.random()*99999),f=n('<table id="table'+c+'"><tbody><\/tbody><\/table>'),i,r,e,o,t=0;t<s;t++){for(i=n("<tr><\/tr>"),r=0;r<h;r++)e=n("<td><br><\/td>"),n(i).append(e);n(f).append(i)}n(u).append(f),o=n(u).html()+"<p><\/p>",this.restoreSelection(),this.execCommand("inserthtml",o),this.modalClose(),this.observeTables()},tableObserver:function(t){this.$table=n(t.target).closest("table"),this.$table_tr=this.$table.find("tr"),this.$table_td=this.$table.find("td"),this.$table_td.removeClass("redactor-current-td"),this.$tbody=n(t.target).closest("tbody"),this.$thead=n(this.$table).find("thead"),this.$current_td=n(t.target),this.$current_td.addClass("redactor-current-td"),this.$current_tr=n(t.target).closest("tr")},deleteTable:function(){n(this.$table).remove(),this.$table=!1,this.syncCode()},deleteRow:function(){n(this.$current_tr).remove(),this.syncCode()},deleteColumn:function(){var t=n(this.$current_td).get(0).cellIndex;n(this.$table).find("tr").each(function(){n(this).find("td").eq(t).remove()}),this.syncCode()},addHead:function(){if(n(this.$table).find("thead").size()!==0)this.deleteHead();else{var t=n(this.$table).find("tr").first().clone();t.find("td").html("&nbsp;"),this.$thead=n("<thead><\/thead>"),this.$thead.append(t),n(this.$table).prepend(this.$thead),this.syncCode()}},deleteHead:function(){n(this.$thead).remove(),this.$thead=!1,this.syncCode()},insertRowAbove:function(){this.insertRow("before")},insertRowBelow:function(){this.insertRow("after")},insertColumnLeft:function(){this.insertColumn("before")},insertColumnRight:function(){this.insertColumn("after")},insertRow:function(t){var i=n(this.$current_tr).clone();i.find("td").html("&nbsp;"),t==="after"?n(this.$current_tr).after(i):n(this.$current_tr).before(i),this.syncCode()},insertColumn:function(t){var i=0;this.$current_td.addClass("redactor-current-td"),this.$current_tr.find("td").each(function(t,r){n(r).hasClass("redactor-current-td")&&(i=t)}),this.$table_tr.each(function(r,u){var f=n(u).find("td").eq(i),e=f.clone();e.html("&nbsp;"),t==="after"?n(f).after(e):n(f).before(e)}),this.syncCode()},showVideo:function(){this.saveSelection(),this.modalInit(RLANG.video,"video",600,n.proxy(function(){n("#redactor_insert_video_btn").click(n.proxy(this.insertVideo,this))},this),function(){n("#redactor_insert_video_area").focus()})},insertVideo:function(){var t=n("#redactor_insert_video_area").val();t=this.stripTags(t),this.restoreSelection(),this.execCommand("inserthtml",t),this.modalClose()},imageEdit:function(t){var i=n(t.target),r=i.parent(),u=n.proxy(function(){n("#redactor_file_alt").val(i.attr("alt")),n("#redactor_image_edit_src").attr("href",i.attr("src")),n("#redactor_form_image_align").val(i.css("float")),n(r).get(0).tagName==="A"&&n("#redactor_file_link").val(n(r).attr("href")),n("#redactor_image_delete_btn").click(n.proxy(function(){this.imageDelete(i)},this)),n("#redactorSaveBtn").click(n.proxy(function(){this.imageSave(i)},this))},this);this.modalInit(RLANG.image,"image_edit",380,u)},imageDelete:function(t){n(t).remove(),this.modalClose(),this.syncCode()},imageSave:function(t){var i=n(t).parent(),u,r;n(t).attr("alt",n("#redactor_file_alt").val()),u=n("#redactor_form_image_align").val(),u==="left"?n(t).css({float:"left",margin:"0 10px 10px 0"}):u==="right"?n(t).css({float:"right",margin:"0 0 10px 10px"}):n(t).css({float:"none",margin:"0"}),r=n.trim(n("#redactor_file_link").val()),r!==""?n(i).get(0).tagName!=="A"?n(t).replaceWith('<a href="'+r+'">'+this.outerHTML(t)+"<\/a>"):n(i).attr("href",r):n(i).get(0).tagName==="A"&&n(i).replaceWith(this.outerHTML(t)),this.modalClose(),this.observeImages(),this.syncCode()},showImage:function(){this.saveSelection();var t=n.proxy(function(){if(this.opts.imageGetJson!==!1?n.getJSON(this.opts.imageGetJson,n.proxy(function(t){var i={},f=0,r,e,u;n.each(t,n.proxy(function(n,t){typeof t.folder!="undefined"&&(f++,i[t.folder]=f)},this)),r=!1,n.each(t,n.proxy(function(t,u){var o="",f,e;typeof u.title!="undefined"&&(o=u.title),f=0,n.isEmptyObject(i)||typeof u.folder=="undefined"||(f=i[u.folder],r===!1&&(r=".redactorfolder"+f)),e=n('<img src="'+u.thumb+'" class="redactorfolder redactorfolder'+f+'" rel="'+u.image+'" title="'+o+'" />'),n("#redactor_image_box").append(e),n(e).click(n.proxy(this.imageSetThumb,this))},this)),n.isEmptyObject(i)||(n(".redactorfolder").hide(),n(r).show(),e=function(t){n(".redactorfolder").hide(),n(".redactorfolder"+n(t.target).val()).show()},u=n('<select id="redactor_image_box_select">'),n.each(i,function(t,i){u.append(n('<option value="'+i+'">'+t+"<\/option>"))}),n("#redactor_image_box").before(u),u.change(e))},this)):n("#redactor_tabs a").eq(1).remove(),this.opts.imageUpload!==!1)this.opts.uploadCrossDomain===!1&&this.isMobile()===!1&&n("#redactor_file").size()!==0&&n("#redactor_file").dragupload({url:this.opts.imageUpload,uploadFields:this.opts.uploadFields,success:n.proxy(this.imageUploadCallback,this)}),this.uploadInit("redactor_file",{auto:!0,url:this.opts.imageUpload,success:n.proxy(this.imageUploadCallback,this)});else if(n(".redactor_tab").hide(),this.opts.imageGetJson===!1)n("#redactor_tabs").remove(),n("#redactor_tab3").show();else{var t=n("#redactor_tabs a");t.eq(0).remove(),t.eq(1).addClass("redactor_tabs_act"),n("#redactor_tab2").show()}n("#redactor_upload_btn").click(n.proxy(this.imageUploadCallbackLink,this))},this),i=n.proxy(function(){this.opts.imageUpload===!1&&this.opts.imageGetJson===!1&&n("#redactor_file_link").focus()},this);this.modalInit(RLANG.image,"image",570,t,i,!0)},imageSetThumb:function(t){this._imageSet('<img src="'+n(t.target).attr("rel")+'" alt="'+n(t.target).attr("title")+'" />',!0)},imageUploadCallbackLink:function(){if(n("#redactor_file_link").val()!==""){var t='<img src="'+n("#redactor_file_link").val()+'" />';this._imageSet(t,!0)}else this.modalClose()},imageUploadCallback:function(n){this._imageSet(n)},_imageSet:function(t,i){if(this.restoreSelection(),t!==!1){var r="",u="";i!==!0?(u=n.parseJSON(t),r='<p><img src="'+u.filelink+'" /><\/p>'):r=t,this.execCommand("inserthtml",r),i!==!0&&typeof this.opts.imageUploadCallback=="function"&&this.opts.imageUploadCallback(this,u)}this.modalClose(),this.observeImages()},showLink:function(){this.saveSelection();var t=n.proxy(function(){var f,e;this.insert_link_node=!1;var t=this.getSelection(),i="",r="",u="";n.browser.msie?(f=this.getParentNode(),f.nodeName==="A"?(this.insert_link_node=n(f),r=this.insert_link_node.text(),i=this.insert_link_node.attr("href"),u=this.insert_link_node.attr("target")):r=this.oldIE()?t.text:t.toString()):t&&t.anchorNode&&t.anchorNode.parentNode.tagName==="A"?(i=t.anchorNode.parentNode.href,r=t.anchorNode.parentNode.text,u=t.anchorNode.parentNode.target,t.toString()===""&&(this.insert_link_node=t.anchorNode.parentNode)):r=t.toString(),n(".redactor_link_text").val(r),e=i.replace(self.location.href,""),i.search("mailto:")===0?(this.setModalTab(2),n("#redactor_tab_selected").val(2),n("#redactor_link_mailto").val(i.replace("mailto:",""))):e.search(/^#/gi)===0?(this.setModalTab(3),n("#redactor_tab_selected").val(3),n("#redactor_link_anchor").val(e.replace(/^#/gi,""))):n("#redactor_link_url").val(i),u==="_blank"&&n("#redactor_link_blank").attr("checked",!0),n("#redactor_insert_link_btn").click(n.proxy(this.insertLink,this))},this),i=function(){n("#redactor_link_url").focus()};this.modalInit(RLANG.link,"link",460,t,i)},insertLink:function(){var r=n("#redactor_tab_selected").val(),t="",i="",u="",f;r==="1"?(t=n("#redactor_link_url").val(),i=n("#redactor_link_url_text").val(),n("#redactor_link_blank").attr("checked")&&(u="_blank"),f=new RegExp("^https?://","i"),t.search(f)==-1&&(t=this.opts.protocol+t)):r==="2"?(t="mailto:"+n("#redactor_link_mailto").val(),i=n("#redactor_link_mailto_text").val()):r==="3"&&(t="#"+n("#redactor_link_anchor").val(),i=n("#redactor_link_anchor_text").val()),this._insertLink('<a href="'+t+'" target="'+u+'">'+i+"<\/a>&nbsp;",n.trim(i),t,u)},_insertLink:function(t,i,r,u){this.$editor.focus(),this.restoreSelection(),i!==""&&(this.insert_link_node?(n(this.insert_link_node).text(i),n(this.insert_link_node).attr("href",r),u!==""&&n(this.insert_link_node).attr("target",u),this.syncCode()):this.execCommand("inserthtml",t)),this.modalClose()},showFile:function(){this.saveSelection();var t=n.proxy(function(){var t=this.getSelection(),i="";i=this.oldIE()?t.text:t.toString(),n("#redactor_filename").val(i),this.opts.uploadCrossDomain===!1&&this.isMobile()===!1&&n("#redactor_file").dragupload({url:this.opts.fileUpload,uploadFields:this.opts.uploadFields,success:n.proxy(function(n){this.fileUploadCallback(n)},this)}),this.uploadInit("redactor_file",{auto:!0,url:this.opts.fileUpload,success:n.proxy(function(n){this.fileUploadCallback(n)},this)})},this);this.modalInit(RLANG.file,"file",500,t)},fileUploadCallback:function(t){var i,r,u;this.restoreSelection(),t!==!1&&(i=n.parseJSON(t),r=n("#redactor_filename").val(),r===""&&(r=i.filename),u='<a href="'+i.filelink+'">'+r+"<\/a>",n.browser.webkit&&!!window.chrome&&(u=u+"&nbsp;"),this.execCommand("inserthtml",u),typeof this.opts.fileUploadCallback=="function"&&this.opts.fileUploadCallback(this,i)),this.modalClose()},modalInit:function(t,i,r,u,f){var e,o;n("#redactor_modal_overlay").size()===0&&(this.overlay=n('<div id="redactor_modal_overlay" style="display: none;"><\/div>'),n("body").prepend(this.overlay)),this.opts.overlay&&(n("#redactor_modal_overlay").show(),n("#redactor_modal_overlay").click(n.proxy(this.modalClose,this))),n("#redactor_modal").size()===0&&(this.modal=n('<div id="redactor_modal" style="display: none;"><div id="redactor_modal_close">&times;<\/div><div id="redactor_modal_header"><\/div><div id="redactor_modal_inner"><\/div><\/div>'),n("body").append(this.modal)),n("#redactor_modal_close").click(n.proxy(this.modalClose,this)),this.hdlModalClose=n.proxy(function(n){n.keyCode===27&&this.modalClose()},this),n(document).keyup(this.hdlModalClose),this.$editor.keyup(this.hdlModalClose),n("#redactor_modal_inner").html(this.opts["modal_"+i]),n("#redactor_modal_header").html(t),n("#redactor_tabs").size()!==0&&(e=this,n("#redactor_tabs a").each(function(t,i){t++,n(i).click(function(){if(n("#redactor_tabs a").removeClass("redactor_tabs_act"),n(this).addClass("redactor_tabs_act"),n(".redactor_tab").hide(),n("#redactor_tab"+t).show(),n("#redactor_tab_selected").val(t),e.isMobile()===!1){var i=n("#redactor_modal").outerHeight();n("#redactor_modal").css("margin-top","-"+(i+10)/2+"px")}})})),n("#redactor_btn_modal_close").click(n.proxy(this.modalClose,this)),typeof u=="function"&&u(),o=n("#redactor_modal").outerHeight(),this.isMobile()===!1?(n("#redactor_modal").css({position:"fixed",top:"50%",left:"50%",width:r+"px",height:"auto",minHeight:"auto",marginTop:"-"+(o+10)/2+"px",marginLeft:"-"+(r+60)/2+"px"}).fadeIn("fast"),this.modalSaveBodyOveflow=n(document.body).css("overflow"),n(document.body).css("overflow","hidden")):n("#redactor_modal").css({position:"fixed",width:"100%",height:"100%",top:"0",left:"0",margin:"0",minHeight:"300px"}).show(),typeof f=="function"&&f()},modalClose:function(){n("#redactor_modal_close").unbind("click",this.modalClose),n("#redactor_modal").fadeOut("fast",n.proxy(function(){n("#redactor_modal_inner").html(""),this.opts.overlay&&(n("#redactor_modal_overlay").hide(),n("#redactor_modal_overlay").unbind("click",this.modalClose)),n(document).unbind("keyup",this.hdlModalClose),this.$editor.unbind("keyup",this.hdlModalClose)},this)),this.isMobile()===!1&&n(document.body).css("overflow",this.modalSaveBodyOveflow)},setModalTab:function(t){n(".redactor_tab").hide();var i=n("#redactor_tabs a");i.removeClass("redactor_tabs_act"),i.eq(t-1).addClass("redactor_tabs_act"),n("#redactor_tab"+t).show()},uploadInit:function(t,i){this.uploadOptions={url:!1,success:!1,start:!1,trigger:!1,auto:!1,input:!1},n.extend(this.uploadOptions,i),n("#"+t).size()!==0&&n("#"+t).get(0).tagName==="INPUT"?(this.uploadOptions.input=n("#"+t),this.element=n(n("#"+t).get(0).form)):this.element=n("#"+t),this.element_action=this.element.attr("action"),this.uploadOptions.auto?n(this.uploadOptions.input).change(n.proxy(function(){this.element.submit(function(){return!1}),this.uploadSubmit()},this)):this.uploadOptions.trigger&&n("#"+this.uploadOptions.trigger).click(n.proxy(this.uploadSubmit,this))},uploadSubmit:function(){this.uploadForm(this.element,this.uploadFrame())},uploadFrame:function(){this.id="f"+Math.floor(Math.random()*99999);var t=document.createElement("div"),i='<iframe style="display:none" id="'+this.id+'" name="'+this.id+'"><\/iframe>';return t.innerHTML=i,document.body.appendChild(t),this.uploadOptions.start&&this.uploadOptions.start(),n("#"+this.id).load(n.proxy(this.uploadLoaded,this)),this.id},uploadForm:function(t,i){var u,f,r,e;this.uploadOptions.input?(u="redactorUploadForm"+this.id,f="redactorUploadFile"+this.id,this.form=n('<form  action="'+this.uploadOptions.url+'" method="POST" target="'+i+'" name="'+u+'" id="'+u+'" enctype="multipart/form-data"><\/form>'),this.opts.uploadFields!==!1&&typeof this.opts.uploadFields=="object"&&n.each(this.opts.uploadFields,n.proxy(function(t,i){i.indexOf("#")===0&&(i=n(i).val());var r=n('<input type="hidden" name="'+t+'" value="'+i+'">');n(this.form).append(r)},this)),r=this.uploadOptions.input,e=n(r).clone(),n(r).attr("id",f),n(r).before(e),n(r).appendTo(this.form),n(this.form).css("position","absolute"),n(this.form).css("top","-2000px"),n(this.form).css("left","-2000px"),n(this.form).appendTo("body"),this.form.submit()):(t.attr("target",i),t.attr("method","POST"),t.attr("enctype","multipart/form-data"),t.attr("action",this.uploadOptions.url),this.element.submit())},uploadLoaded:function(){var t=n("#"+this.id),i,r,u;i=t.contentDocument?t.contentDocument:t.contentWindow?t.contentWindow.document:window.frames[this.id].document,this.uploadOptions.success&&(typeof i!="undefined"?(r=i.body.innerHTML,u=r.match(/\{.*\}/)[0],this.uploadOptions.success(u)):(alert("Upload failed!"),this.uploadOptions.success(!1))),this.element.attr("action",this.element_action),this.element.attr("target","")},oldIE:function(){return n.browser.msie&&parseInt(n.browser.version,10)<9?!0:!1},outerHTML:function(t){return n("<p>").append(n(t).eq(0).clone()).html()},normalize:function(n){return parseInt(n.replace("px",""),10)},isMobile:function(n){return n===!0&&/(iPhone|iPod|iPad|BlackBerry|Android)/.test(navigator.userAgent)?!0:/(iPhone|iPod|BlackBerry|Android)/.test(navigator.userAgent)?!0:!1}},n.fn.getEditor=function(){return this.data("redactor").$editor},n.fn.getCode=function(){return this.data("redactor").getCode()},n.fn.getText=function(){return this.data("redactor").$editor.text()},n.fn.getSelected=function(){return this.data("redactor").getSelectedHtml()},n.fn.setCode=function(n){this.data("redactor").setCode(n)},n.fn.insertHtml=function(n){this.data("redactor").insertHtml(n)},n.fn.destroyEditor=function(){this.data("redactor").destroy(),this.removeData("redactor")},n.fn.setFocus=function(){this.data("redactor").$editor.focus()},n.fn.execCommand=function(n,t){this.data("redactor").execCommand(n,t)}}(jQuery),function(n){"use strict";function t(t,i){this.opts=n.extend({url:!1,success:!1,preview:!1,uploadFields:!1,text:RLANG.drop_file_here,atext:RLANG.or_choose},i),this.$el=n(t)}n.fn.dragupload=function(n){return this.each(function(){var i=new t(this,n);i.init()})},t.prototype={init:function(){var i,t,r;n.browser.msie||(this.droparea=n('<div class="redactor_droparea"><\/div>'),this.dropareabox=n('<div class="redactor_dropareabox">'+this.opts.text+"<\/div>"),this.dropalternative=n('<div class="redactor_dropalternative">'+this.opts.atext+"<\/div>"),this.droparea.append(this.dropareabox),this.$el.before(this.droparea),this.$el.before(this.dropalternative),this.dropareabox.bind("dragover",n.proxy(function(){return this.ondrag()},this)),this.dropareabox.bind("dragleave",n.proxy(function(){return this.ondragleave()},this)),i=n.proxy(function(n){var t=parseInt(n.loaded/n.total*100,10);this.dropareabox.text("Loading "+t+"%")},this),t=jQuery.ajaxSettings.xhr(),t.upload&&t.upload.addEventListener("progress",i,!1),r=function(){return t},this.dropareabox.get(0).ondrop=n.proxy(function(t){t.preventDefault(),this.dropareabox.removeClass("hover").addClass("drop");var u=t.dataTransfer.files[0],i=new FormData;this.opts.uploadFields!==!1&&typeof this.opts.uploadFields=="object"&&n.each(this.opts.uploadFields,n.proxy(function(t,r){r.indexOf("#")===0&&(r=n(r).val()),i.append(t,r)},this)),i.append("file",u),n.ajax({dataType:"html",url:this.opts.url,data:i,xhr:r,cache:!1,contentType:!1,processData:!1,type:"POST",success:n.proxy(function(n){this.opts.success!==!1&&this.opts.success(n),this.opts.preview===!0&&this.dropareabox.html(n)},this)})},this))},ondrag:function(){return this.dropareabox.addClass("hover"),!1},ondragleave:function(){return this.dropareabox.removeClass("hover"),!1}}}(jQuery),function(n){"use strict";var i="http://",r=/(^|&lt;|\s)(www\..+?\..+?)(\s|&gt;|$)/g,u=/(^|&lt;|\s)(((https?|ftp):\/\/|mailto:).+?)(\s|&gt;|$)/g,t=function(){for(var o=this.childNodes,s=o.length,f,e;s--;)f=o[s],f.nodeType===3?(e=f.nodeValue,e&&(e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(r,'$1<a href="'+i+'$2">$2<\/a>$3').replace(u,'$1<a href="$2">$2<\/a>$5'),n(f).after(e).remove())):f.nodeType!==1||/^(a|button|textarea)$/i.test(f.tagName)||t.call(f)};n.fn.linkify=function(){this.each(t)}}(jQuery),function(n){n.event.special.textselect={setup:function(t){n(this).data("textselected",!1),n(this).data("ttt",t),n(this).bind("mouseup",n.event.special.textselect.handler)},teardown:function(){n(this).unbind("mouseup",n.event.special.textselect.handler)},handler:function(t){var r=n(this).data("ttt"),i=n.event.special.textselect.getSelectedText(r).toString();i!=""&&(n(this).data("textselected",!0),t.type="textselect",t.text=i,n.event.handle.apply(this,arguments))},getSelectedText:function(){var n="";return window.getSelection?n=window.getSelection():document.getSelection?n=document.getSelection():document.selection&&(n=document.selection.createRange().text),n}},n.event.special.textunselect={setup:function(t){n(this).data("rttt",t),n(this).data("textselected",!1),n(this).bind("mouseup",n.event.special.textunselect.handler),n(this).bind("keyup",n.event.special.textunselect.handlerKey)},teardown:function(){n(this).unbind("mouseup",n.event.special.textunselect.handler)},handler:function(t){if(n(this).data("textselected")){var i=n(this).data("rttt"),r=n.event.special.textselect.getSelectedText(i).toString();r==""&&(n(this).data("textselected",!1),t.type="textunselect",n.event.handle.apply(this,arguments))}},handlerKey:function(t){if(n(this).data("textselected")){var i=n(this).data("rttt"),r=n.event.special.textselect.getSelectedText(i).toString();(t.keyCode=27)&&r==""&&(n(this).data("textselected",!1),t.type="textunselect",n.event.handle.apply(this,arguments))}}}}(jQuery);
//@ sourceMappingURL=redactor.min.js.map